{"version":3,"sources":["../../../../src/graphql/resolvers/User/index.js"],"names":["Query","user","root","req","ctx","findOne","_id","Types","ObjectId","agent","role","player","agentPlayers","find","Agent","agentPlayer","Player","Mutation","switchPlayerActivate","title","content","status","findOneAndUpdate","$set","isActivate","new","username","playerMutation","isEmpty","passcode","newNickname","nickname","newPassword","password","newPasscode","newInitial","Number","newMaxWin","newMinRisk","isSetNewWagerLimit","newParlay","newParlayTeam","newBasicTeaser","newBasicTeaserTeam","newSpecialTeaser","newSpecialTeaserTeam","newBigTeaser","newBigTeaserTeam","newSuperTeaser","newWinReverse","newWinReverseTeam","newActionReverse","newActionReverseTeam","create"],"mappings":"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","file":"index.js","sourcesContent":["import mongoose from 'mongoose';\nimport User from '../../../models/User';\nimport Agent from '../../../models/User.Agent';\nimport Player from '../../../models/User.Player';\nimport moment from 'moment';\nimport _ from 'lodash';\nimport SystemLog from '../../../models/SystemLog';\n\nexport const Query = {\n\tuser(root, req, ctx){\n\t\treturn User.findOne({ _id: mongoose.Types.ObjectId(ctx.user._id) });\n\t},\n\tagent(root, req, ctx){\n\t\tif(ctx.user && ctx.user.role !== 'Agent') return null;\n\t\treturn Agent.findOne({ _id: mongoose.Types.ObjectId(ctx.user._id) });\n\t},\n\tplayer(root, req, ctx){\n\t\tif(ctx.user.role === 'Guest') return null;\n\t\treturn Player.findOne({ _id: mongoose.Types.ObjectId(ctx.user._id) });\n\t},\n\tagentPlayers(root, req, ctx) {\n\t\tif(ctx.user.role !== 'Agent') return null;\n\t\treturn Player.find({ Agent: mongoose.Types.ObjectId(ctx.user._id) });\n\t},\n\tagentPlayer(root, req, ctx){\n\t\tif(ctx.user.role !== 'Agent' || req.Player === '') return null;\n\t\treturn Player.findOne({ _id: mongoose.Types.ObjectId(req.Player) });\n\t}\n};\n\nexport const Mutation = {\n\tasync switchPlayerActivate(root, req, ctx){\n\t\tif(ctx.user.role !== 'Agent') return { title: 'Not Authenticated', content: 'Please try again.', status: 'warning' };\n\t\tconst player = await Player.findOneAndUpdate({ Agent: mongoose.Types.ObjectId(ctx.user._id), _id: mongoose.Types.ObjectId(req.Player) }, { $set: { isActivate: req.isActivate } }, { new: true });\n\t\tif(!player) return { title: 'Not Authenticated', content: 'Please try again.', status: 'warning' };\n\t\treturn { title: player.username, content: player.isActivate, status: 'success' };\n\t},\n\tasync playerMutation(root, req, ctx){\n\t\ttry { \n\t\t\tif(ctx.user.role !== 'Agent') return { title: 'Not Authenticated', content: 'Please try again.', status: 'warning' };\n\t\t\tif(_.isEmpty(req.Player)) return { title: 'Missing Player', content: 'Please try again.', status: 'warning' };\n\t\t\tif(_.isEmpty(req.passcode)) return { title: 'Missing Passcode', content: 'Please try again.', status: 'warning' };\n\t\t\tconst agent = await Agent.findOne({ _id: mongoose.Types.ObjectId(ctx.user._id) }, 'passcode');\n\t\t\tif(agent.passcode !== req.passcode) return { title: 'Not Authenticated', content: 'Please try again.', status: 'warning' };\n\t\t\tconst player = await Player.findOne({ Agent: mongoose.Types.ObjectId(ctx.user._id), _id: mongoose.Types.ObjectId(req.Player) });\n\t\t\tif(!player) return { title: 'Not Authenticated', content: 'Please try again.', status: 'warning' };\n\n\t\t\tif(!_.isEmpty(req.newNickname)) { await Player.findOneAndUpdate({ _id: mongoose.Types.ObjectId(req.Player) }, { $set: { nickname: req.newNickname } }); }\n\t\t\tif(!_.isEmpty(req.newPassword)) { await Player.findOneAndUpdate({ _id: mongoose.Types.ObjectId(req.Player) }, { $set: { password: req.newPassword } }); }\n\t\t\tif(!_.isEmpty(req.newPasscode)) { await Player.findOneAndUpdate({ _id: mongoose.Types.ObjectId(req.Player) }, { $set: { passcode: req.newPasscode } }); }\n\t\t\tif(!_.isEmpty(req.newInitial)) { await Player.findOneAndUpdate({ _id: mongoose.Types.ObjectId(req.Player) }, { $set: { 'credit.initial': Number(req.newInitial) } }); }\n\t\t\tif(!_.isEmpty(req.newMaxWin)){ await Player.findOneAndUpdate({ _id: mongoose.Types.ObjectId(req.Player) }, { $set: { 'wagerLimit.maxWin': Number(req.newMaxWin) } }); }\n\t\t\tif(!_.isEmpty(req.newMinRisk)){ await Player.findOneAndUpdate({ _id: mongoose.Types.ObjectId(req.Player) }, { $set: { 'wagerLimit.minRisk': Number(req.newMinRisk) } }); }\n\n\t\t\tif(req.isSetNewWagerLimit){\n\t\t\t\tawait Player.findOneAndUpdate( { _id: mongoose.Types.ObjectId(req.Player) }, { $set: { \n\t\t\t\t\t'wagerLimit.parlay': req.newParlay,\n\t\t\t\t\t'wagerLimit.parlayTeam': req.newParlayTeam,\n\t\t\t\t\t'wagerLimit.basicTeaser': req.newBasicTeaser,\n\t\t\t\t\t'wagerLimit.basicTeaserTeam': req.newBasicTeaserTeam,\n\t\t\t\t\t'wagerLimit.specialTeaser': req.newSpecialTeaser,\n\t\t\t\t\t'wagerLimit.specialTeaserTeam': req.newSpecialTeaserTeam,\n\t\t\t\t\t'wagerLimit.bigTeaser': req.newBigTeaser,\n\t\t\t\t\t'wagerLimit.bigTeaserTeam': req.newBigTeaserTeam,\n\t\t\t\t\t'wagerLimit.superTeaser': req.newSuperTeaser,\n\t\t\t\t\t'wagerLimit.winReverse': req.newWinReverse,\n\t\t\t\t\t'wagerLimit.winReverseTeam': req.newWinReverseTeam,\n\t\t\t\t\t'wagerLimit.actionReverse': req.newActionReverse,\n\t\t\t\t\t'wagerLimit.actionReverseTeam': req.newActionReverseTeam,\n\t\t\t\t\t'wagerLimit.updatedAt': moment()\n\t\t\t\t}});\n\t\t\t}\n\t\t\tawait SystemLog.create({ title: 'Updated Player', content: `${ctx.user.username} Updated Player ${player.username}`, status: 'success' });\n\t\t\treturn { title: 'Edit', content: 'Successful', status: 'success' };\n\t\t} catch (e) {\n\t\t\tawait SystemLog.create({ title: 'Update Player Failed', content: `${ctx.user.username} Updated Player Failed ${req.Player} ${e}`, status: 'danger' });\n\t\t\treturn { title: 'Unknow Error', content: 'Please try again later!', status: 'danger' };\n\t\t}\n\t}\n};"]}