{"version":3,"sources":["../../src/middleware/addUserToReq.js"],"names":["addUserToReq","req","res","next","token","headers","decodeToken","verify","jwtSecret","findOneAndUpdate","_id","Types","ObjectId","$set","lastOnlineAt","user","pick","username","role","createdAt"],"mappings":";;;;;;AAAA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;;;;;AAEA,IAAMA;AAAA,oEAAe,iBAAOC,GAAP,EAAYC,GAAZ,EAAiBC,IAAjB;AAAA;AAAA;AAAA;AAAA;AAAA;AACdC,WADc,GACNH,IAAII,OAAJ,CAAY,eAAZ,CADM;;AAEpB,UAAG,CAACD,KAAJ,EAAWD;AAFS;AAIbG,iBAJa,GAIC,uBAAIC,MAAJ,CAAWH,KAAX,EAAkB,iBAAOI,SAAzB,CAJD;AAAA;AAAA,aAKA,eAAKC,gBAAL,CAAsB,EAAEC,KAAK,mBAASC,KAAT,CAAeC,QAAf,CAAwBN,YAAYI,GAApC,CAAP,EAAtB,EAAyE,EAACG,MAAM,EAAEC,cAAc,uBAAhB,EAAP,EAAzE,CALA;;AAAA;AAKbC,UALa;;AAMnBd,UAAIc,IAAJ,GAAW,iBAAEC,IAAF,CAAOD,IAAP,EAAa,CAAC,KAAD,EAAQ,UAAR,EAAoB,MAApB,EAA4B,WAA5B,CAAb,CAAX;AACAZ;AAPmB;AAAA;;AAAA;AAAA;AAAA;;AASnBF,UAAIc,IAAJ,GAAW,EAAEL,KAAK,EAAP,EAAWO,UAAU,QAArB,EAA+BC,MAAM,OAArC,EAA8CC,WAAW,uBAAzD,EAAX;AACAhB;;AAVmB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAAf;;AAAA;AAAA;AAAA;AAAA,GAAN;;kBAceH,Y","file":"addUserToReq.js","sourcesContent":["import mongoose from 'mongoose';\nimport jwt from 'jsonwebtoken';\nimport moment from 'moment';\nimport config from '../config';\nimport User from '../models/User';\nimport _ from 'lodash';\n\nconst addUserToReq = async (req, res, next) => {\n\tconst token = req.headers['authorization'];\n\tif(!token) next();\n\ttry {\n\t\tconst decodeToken = jwt.verify(token, config.jwtSecret);\n\t\tconst user = await User.findOneAndUpdate({ _id: mongoose.Types.ObjectId(decodeToken._id) }, {$set: { lastOnlineAt: moment() }});\n\t\treq.user = _.pick(user, ['_id', 'username', 'role', 'createdAt']);\n\t\tnext();\n\t} catch (e) {\n\t\treq.user = { _id: '', username: 'vistor', role: 'Guest', createdAt: moment() };\n\t\tnext();\n\t}\n};\n\nexport default addUserToReq;"]}